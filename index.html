<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo | CGerAJ Blog</title>

  
  <meta name="author" content="CGerAJ">
  

  
  <meta name="description" content="学而不思则罔 思而不学则殆">
  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="Hexo"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Hexo</a>
    </h1>
    <p class="site-description">CGerAJ Blog</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2018/07/17/前端小白 的 docker 配置nginx踩坑之旅/"><span>小白 的 docker 配置nginx踩坑之旅</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/07/17/前端小白 的 docker 配置nginx踩坑之旅/" rel="bookmark">
        <time class="entry-date published" datetime="2018-07-17T02:22:10.057Z">
          2018-07-17
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//查看系统版本</div><div class="line">lsb_release -a</div><div class="line"></div><div class="line">//输出</div><div class="line">LSB Version:	:core-4.1-amd64:core-4.1-noarch</div><div class="line">Distributor ID:	CentOS</div><div class="line">Description:	CentOS Linux release 7.5.1804 (Core)</div><div class="line">Release:	7.5.1804</div><div class="line">Codename:	Core</div></pre></td></tr></table></figure>
<p>##docker 安装及pull镜像不表(具体参考官方文档)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">https://docs.docker.com/install/linux/docker-ce/centos/</div><div class="line"></div><div class="line">不熟悉nginx 如何快速配置。强烈建议先看文档 </div><div class="line">https://hub.docker.com/_/nginx/</div></pre></td></tr></table></figure>
<h2 id="坑在这（捂脸）"><a href="#坑在这（捂脸）" class="headerlink" title="坑在这（捂脸）"></a>坑在这（捂脸）</h2><p>原因:docker 安装gitlab 导致 服务器ssl被变更 然后服务器死循环 无法登录 没有排查出问题所在 卒 重装</p>
<p>经过:</p>
<p>1.没看清楚文档就开始玩 虽然对nginx如何运行很清楚 但对配置了解的并不是特别清晰 直接映射目录到docker内部 执行。不报错（捂脸 此时一脸懵逼 不显示我的自定义页面）</p>
<p>2.定位问题 修改配置。文件映射内部地址 和 宿主机地址 不匹配 找找官方文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://hub.docker.com/_/nginx/</div></pre></td></tr></table></figure>
<p>提取出以下目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">-v /host/path/nginx.conf:/etc/nginx/nginx.conf</div><div class="line"></div><div class="line"></div><div class="line">/etc/nginx/nginx.conf</div><div class="line">/etc/nginx/conf.d/mysite.template</div><div class="line">/usr/share/nginx/html</div></pre></td></tr></table></figure>
<p>此时找到坑了 文件映射目录不对</p>
<p>3.修改配置 重新运行容器</p>
<p>docker 容器创建了 但不执行 啥问题？？？</p>
<p>联想到可能是nginx.conf 映射文件不对<br>对比nginx.conf文件 发现 确实两个文件内配置存在误差</p>
<p>两个配置就不上了 写了 发现对于阅读文章体验不好 就删了～</p>
<p>配置区别在这</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#upload max file</div><div class="line">client_max_body_size 11M;</div><div class="line">client_body_buffer_size 128k;</div><div class="line"> </div><div class="line">#此处不明白为何会产生无法访问的问题</div></pre></td></tr></table></figure>
<p>结果: 最后不映射nginx.conf 解决战斗～</p>
<h4 id="开启443端口和80端口"><a href="#开启443端口和80端口" class="headerlink" title="开启443端口和80端口"></a>开启443端口和80端口</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">//输出目录地址</div><div class="line">pwd </div><div class="line"> /root/nginx</div><div class="line"> </div><div class="line"> //整个结构如下</div><div class="line">├── conf //配置文件</div><div class="line">│   ├── default.conf</div><div class="line">│   └── default.conf.bak</div><div class="line">├── html. //默认显示目录</div><div class="line">│   └── index.html</div><div class="line">├── logs //日志目录</div><div class="line">│   ├── access.log</div><div class="line">│   └── error.log</div><div class="line">├── nginx.conf  //祝配置文件</div><div class="line">├── ssh</div><div class="line">│   ├── certificate.crt //下载pem nginx 证书</div><div class="line">│   └── certificate.key //下载pem nginx 证书</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">docker run --detach \</div><div class="line">        --name nginxserver \</div><div class="line">        -p 443:443\</div><div class="line">        -p 80:80 \</div><div class="line">        -v /root/nginx/html:/usr/share/nginx/html:rw\</div><div class="line">        -v /root/nginx/conf/default.conf:/etc/nginx/conf.d/default.conf:rw\</div><div class="line">        -v /root/nginx/ssh:/ssl/:rw\</div><div class="line">        -d nginx</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">--name docker容器名</div><div class="line">  </div><div class="line">```</div></pre></td></tr></table></figure>
<p>-p 映射端口</p>
<p>#文件目录映射  html下的自定义文件<br>-v /root/nginx/html:/usr/share/nginx/html:rw\</p>
<p>#自定义配置文件default.conf<br>-v /root/nginx/conf/default.conf:/etc/nginx/conf.d/default.conf:rw\</p>
<p>#服务器ssl文件<br>-v  -v /root/nginx/ssh:/ssl/:rw\</p>
<p>-d 后台(background)运行  </p>
<p>#访问容器内部<br>sudo docker exec -it ID /bin/bash  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#/bin/bash 不一定是这个命令 具体用docker ps可以看到</div></pre></td></tr></table></figure>
<p>以上是我的成功配置。</p>
<p>最后上图</p>
<p><img src="http://oh5it7vsf.bkt.clouddn.com/nginx.png" alt="Docker容器 nginx文件映射关系"></p>
<p>文章写的不清晰的地方 烦请指正！谢谢！</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/nginx-docker-centos/">nginx docker centos</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/02/01/asciinema  docker container/"><span>asciinema bash 录制工具</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/02/01/asciinema  docker container/" rel="bookmark">
        <time class="entry-date published" datetime="2018-02-01T02:13:19.174Z">
          2018-02-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <a id="more"></a>
<p>##[工具推荐]使用docker安装asciinema 实现录制 bash 可复制视频内代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker pull asciinema/asciinema</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --rm -ti -v &quot;$HOME/.config/asciinema&quot;:/root/.config/asciinema asciinema/asciinema</div></pre></td></tr></table></figure>
<p>//执行以上命令 进入到docker容器了 开始了录制<br>//可选择是否安装 播放工具foobar</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apt-get install foobar</div></pre></td></tr></table></figure>
<p>//如果需要传到asciinema 你需要在bash 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">asciinema auth</div></pre></td></tr></table></figure>
<p>// 出来一个网站  登录进去可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//演示路径 以本机产生的路径为准</div><div class="line">https//:www.*****.com/345667543245676432454</div></pre></td></tr></table></figure>
<p>//结束录制 会让你选择上传还是不上传 上传的是一个JSON文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">exit</div></pre></td></tr></table></figure>
<h3 id="如果你需要在你的网站内展示"><a href="#如果你需要在你的网站内展示" class="headerlink" title="如果你需要在你的网站内展示"></a>如果你需要在你的网站内展示</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://github.com/asciinema/asciinema-player</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">Download this recording</div><div class="line">You can download this recording in asciicast v1 format, as a .json file.</div><div class="line"></div><div class="line">Download</div><div class="line">Replay in terminal</div><div class="line">You can replay this recording in your terminal with asciinema play command:</div><div class="line"></div><div class="line">asciinema play 160407.json</div><div class="line">If you don&apos;t have asciinema cli installed then see installation instructions.</div><div class="line"></div><div class="line">Use with stand-alone player on your website</div><div class="line">Download asciinema player from player&apos;s releases page (you only need .js and .css file), then use it like this:</div><div class="line"></div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">  &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/asciinema-player.css&quot; /&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">  &lt;asciinema-player src=&quot;/160407.json&quot; cols=&quot;130&quot; rows=&quot;34&quot;&gt;&lt;/asciinema-player&gt;</div><div class="line">  ...</div><div class="line">  &lt;script src=&quot;/asciinema-player.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div><div class="line"></div><div class="line">See asciinema player README for full usage instructions.</div></pre></td></tr></table></figure>
<p><img src="http://mwebblog-1252916789.coscd.myqcloud.com/1111111111.png?sign=FSDCx5MZwSbStr6E0nW9E68mEzlhPTEyNTI5MTY3ODkmaz1BS0lESWR0eHdzUk51SVVUS082N0M1bGtjSW04SUxHTUo1dWYmZT0xNTIwMDQ0NDY2JnQ9MTUxNzQ1MjQ2NiZyPTExNTQzNzM2OTQmZj0vMTExMTExMTExMS5wbmcmYj1td2ViYmxvZw==" alt=""></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/asciinema/">asciinema</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/12/04/mysql学习/"><span>mysql 基础学习</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/12/04/mysql学习/" rel="bookmark">
        <time class="entry-date published" datetime="2017-12-04T02:21:14.506Z">
          2017-12-04
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <a id="more"></a>
<h2 id="mysql-学习"><a href="#mysql-学习" class="headerlink" title="mysql 学习"></a>mysql 学习</h2><p>-参考资料 <a href="http://img.jb51.net/shouce/mysql/index.html" target="_blank" rel="external">mysql在线参考手册</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// 管理员登录mysql</div><div class="line">mysql -u root -p</div><div class="line"></div><div class="line">// 查看mysql版本号和当前日期</div><div class="line"></div><div class="line">SELECT VERSION(), CURRENT_DATE;</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>提示符</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>mysql&gt;</td>
<td>准备好接受新命令。</td>
</tr>
<tr>
<td>-&gt;</td>
<td>等待多行命令的下一行。</td>
</tr>
<tr>
<td>‘&gt;</td>
<td>等待下一行，等待以单引号(“’”)开始的字符串的结束。</td>
</tr>
<tr>
<td>“&gt;</td>
<td>等待下一行，等待以双引号(“””)开始的字符串的结束。</td>
</tr>
<tr>
<td>`&gt;</td>
<td>等待下一行，等待以反斜点(” ”)开始的识别符的结束。</td>
</tr>
<tr>
<td>/*&gt;</td>
<td>等待下一行，等待以 开始的注释的结束。</td>
</tr>
</tbody>
</table>
<h4 id="创建并使用数据库"><a href="#创建并使用数据库" class="headerlink" title="创建并使用数据库"></a>创建并使用数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">// 显示数据库</div><div class="line">SHOW DATABASES;</div><div class="line"></div><div class="line">// 创建数据库  严格区分大小写</div><div class="line">CREATE DATABASE menagerie;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">//创建pet数据表  在DataGrip内编辑</div><div class="line"></div><div class="line">CREATE TABLE pet</div><div class="line">(</div><div class="line">  item_id   INT AUTO_INCREMENT</div><div class="line">  COMMENT &apos;item id&apos;</div><div class="line">    PRIMARY KEY,</div><div class="line">  item_name VARCHAR(20)            NOT NULL</div><div class="line">  COMMENT &apos;命名空间格式&apos;,</div><div class="line">  owner     VARCHAR(20)            NOT NULL</div><div class="line">  COMMENT &apos;owner&apos;,</div><div class="line">  species   VARCHAR(20) DEFAULT &apos;&apos; NOT NULL</div><div class="line">  COMMENT &apos;species&apos;,</div><div class="line">  sex       CHAR                   NOT NULL</div><div class="line">  COMMENT &apos;sex&apos;,</div><div class="line">  birth     DATE                   NOT NULL</div><div class="line">  COMMENT &apos;birth&apos;,</div><div class="line">  death     DATE                   NOT NULL</div><div class="line">  COMMENT &apos;death&apos;</div><div class="line">);</div><div class="line"></div><div class="line">//使用数据库  USE 使用 menagerie数据库名  </div><div class="line">USE menagerie;</div><div class="line"></div><div class="line"></div><div class="line">// 显示数据表</div><div class="line">SHOW TABLES;</div><div class="line"></div><div class="line">//  查看表</div><div class="line">DESCRIBE pet;</div></pre></td></tr></table></figure>
<h3 id="通过文件导入数据"><a href="#通过文件导入数据" class="headerlink" title="通过文件导入数据"></a>通过文件导入数据</h3><ul>
<li>新建1.txt 文件 写入数据  中间用tab建隔开  空值用\N 标识</li>
<li>docker容易内部的mysql 懒 不想映射文件了 略过</li>
<li><a href="http://www.jb51.net/article/21117.htm" target="_blank" rel="external">参考资料:MySQL 文本文件的导入导出数据的方法</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">LOAD DATA LOCAL INFILE &apos;/path/pet.txt&apos; INTO TABLE pet;</div></pre></td></tr></table></figure>
<h4 id="新增一条数据"><a href="#新增一条数据" class="headerlink" title="新增一条数据"></a>新增一条数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">INSERT INTO pet </div><div class="line">VALUES(&apos;数据&apos;)</div></pre></td></tr></table></figure>
<h3 id="cat表数据"><a href="#cat表数据" class="headerlink" title="cat表数据"></a>cat表数据</h3><table border="1" style="border-collapse:collapse"><br><tr><th>item_id</th><th>item_name</th><th>owner</th><th>species</th><th>sex</th><th>birth</th><th>death</th></tr><br><tr><td>1</td><td>Fluffy</td><td>Harold</td><td>cat</td><td>f</td><td>2017-12-21</td><td>2017-12-31</td></tr><br><tr><td>2</td><td>Claws</td><td>Gwen</td><td>cat</td><td>m</td><td>2017-12-17</td><td>2017-12-30</td></tr><br><tr><td>3</td><td>Buffy</td><td>Harold</td><td>cat</td><td>f</td><td>2017-01-02</td><td>2017-12-02</td></tr></table>



<h4 id="选择所有数据"><a href="#选择所有数据" class="headerlink" title="选择所有数据"></a>选择所有数据</h4><p>在MySQL中，0或 NULL意味着假而其它值意味着真。布尔运算的默认真值是1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line">//  查看pet表所有数据</div><div class="line">SELECT * FROM pet;</div><div class="line"></div><div class="line">// 更新数据</div><div class="line">UPDATE pet SET birth = &apos;1989-08-31&apos; WHERE name = &apos;Bowser&apos;;</div><div class="line"></div><div class="line">// 查找条件</div><div class="line">SELECT * FROM pet WHERE birth &gt; &apos;2017-12-20&apos;;</div><div class="line"></div><div class="line">// AND操作符 多条件查询  AND优先级大于OR</div><div class="line">SELECT * FROM pet WHERE species = &apos;cat&apos; AND sex = &apos;f&apos;;</div><div class="line"></div><div class="line">// OR操作符</div><div class="line">SELECT * FROM pet WHERE owner = &apos;Harold&apos; or sex = &apos;f&apos;;</div><div class="line"></div><div class="line">//使用多个操作符 使用圆括号指明如何对条件进行分组</div><div class="line">SELECT * FROM pet WHERE (species = &apos;cat&apos; AND sex = &apos;m&apos;) OR (owner = &apos;Harold&apos; AND birth = &apos;2017-12-21&apos;);</div><div class="line"></div><div class="line">//选择特殊列 </div><div class="line">SELECT name, birth FROM pet;</div><div class="line"></div><div class="line">//关键字DISTINCT  重复的不展示</div><div class="line">SELECT DISTINCT owner FROM pet;</div><div class="line"></div><div class="line">//分类行 排序</div><div class="line">SELECT item_name, birth FROM pet ORDER BY birth;</div><div class="line"></div><div class="line">//分类行 排序 DESC（降序）</div><div class="line">SELECT item_name, birth FROM pet ORDER BY birth DESC;</div><div class="line"></div><div class="line">//查询 计算</div><div class="line">SELECT item_name, birth, death,(YEAR(death)-YEAR(birth)) - (RIGHT(death,5)&lt;RIGHT(birth,5))</div><div class="line">AS age</div><div class="line">FROM pet WHERE death IS NOT NULL ORDER BY age;</div><div class="line"></div><div class="line">//模式匹配  找出以“b”开头的名字</div><div class="line">SELECT * FROM pet WHERE item_name LIKE &apos;b%&apos;;</div><div class="line"></div><div class="line">//模式匹配  找出以“fy”开头的名字</div><div class="line">SELECT * FROM pet WHERE  item_name LIKE &apos;%fy&apos;;</div><div class="line"></div><div class="line">//模式匹配  找出“ff”中间的名字</div><div class="line">SELECT * FROM pet WHERE  item_name LIKE &apos;%ff%&apos;;</div><div class="line"></div><div class="line">//正则匹配  找出以B开头的名字</div><div class="line">SELECT * FROM pet WHERE item_name REGEXP &apos;^B&apos;;</div><div class="line"></div><div class="line">//强制使REGEXP比较区分大小写 使用BINARY关键字使其中一个字符串变为二进制字符串</div><div class="line">SELECT * FROM pet WHERE species REGEXP BINARY &apos;^c&apos;;</div><div class="line"></div><div class="line">//正则匹配  使用“$”匹配名字的结尾</div><div class="line">SELECT * FROM pet WHERE owner REGEXP &apos;ld$&apos;;</div><div class="line"></div><div class="line">//正则匹配  找出包含一个“a”的名字</div><div class="line">SELECT * FROM pet WHERE item_name REGEXP &apos;a&apos;;</div><div class="line"></div><div class="line">//正则匹配 为了找出包含正好5个字符的名字</div><div class="line">SELECT * FROM pet WHERE item_name REGEXP &apos;^.....$&apos;;</div><div class="line"></div><div class="line">//为了使输出减到最少，关键字DISTINCT检索出每个唯一的输出记录</div><div class="line">SELECT DISTINCT owner FROM pet;</div><div class="line"></div><div class="line">// 联合查询</div><div class="line">SELECT item_name, species, birth FROM pet WHERE species = &apos;dog&apos; OR species = &apos;cat&apos;;</div><div class="line"></div><div class="line">// 分类行</div><div class="line">SELECT item_name, birth FROM pet ORDER BY birth;</div><div class="line"></div><div class="line">// 默认排序是升序，最小的值在第一。要想以降序排序，在你正在排序的列名上增加DESC（降序 ）关键字</div><div class="line">SELECT item_name, birth FROM pet ORDER BY birth DESC;</div><div class="line"></div><div class="line">// 多个列进行排序</div><div class="line">SELECT item_name, species, birth FROM pet  ORDER BY species, birth DESC;</div><div class="line"></div><div class="line"></div><div class="line">// mysql 日期函数</div><div class="line"></div><div class="line"># 日期函数 获取生日</div><div class="line">SELECT item_name, birth, MONTH(birth) FROM pet;</div><div class="line"></div><div class="line"># 一月生日的用户 查不到不返回结果 判断结果 empty</div><div class="line">SELECT item_name, birth FROM pet WHERE MONTH(birth) = 10;</div><div class="line"></div><div class="line">//NULL值操作</div><div class="line">SELECT 1 = NULL, 1 &lt;&gt; NULL, 1 &lt; NULL, 1 &gt; NULL;</div><div class="line"></div><div class="line">// 计数行</div><div class="line">SELECT COUNT(*) FROM pet;</div><div class="line"></div><div class="line"> //列的最大值</div><div class="line">SELECT MAX(article) AS article FROM shop;</div></pre></td></tr></table></figure>
<p><a href="http://img.jb51.net/shouce/mysql/MySQL/regexp.html" target="_blank" rel="external">附录G：MySQL正则表达式 提供了关于正则表达式的句法的详细信息。</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/11/14/phpstorm设置babel，使用ES6编译ES5/"><span>phpstorm设置babel，使用ES6编译ES5</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/11/14/phpstorm设置babel，使用ES6编译ES5/" rel="bookmark">
        <time class="entry-date published" datetime="2017-11-14T01:55:58.000Z">
          2017-11-14
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <a id="more"></a> 
<ul>
<li>图片都在google图床 请自行科学上网</li>
<li>PhpStorm 2017.2.4 / webStorm 2017.2</li>
<li>Mac OS X 10.12.6</li>
<li>node v8.1.2 默认已安装</li>
<li>npm 5.5.1 默认已安装</li>
</ul>
<p>使用PhpStorm/webStorm自带的filewatcher中的babel自动编译前，需要安装一些babel库</p>
<h6 id="全局安装（webstorm自动识别路径）"><a href="#全局安装（webstorm自动识别路径）" class="headerlink" title="全局安装（webstorm自动识别路径）"></a>全局安装（webstorm自动识别路径）</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g babel-cli</div></pre></td></tr></table></figure>
<h6 id="项目内安装（需要指定目录至项目内的babel文件）"><a href="#项目内安装（需要指定目录至项目内的babel文件）" class="headerlink" title="项目内安装（需要指定目录至项目内的babel文件）"></a>项目内安装（需要指定目录至项目内的babel文件）</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install babel-cli --save-dev</div></pre></td></tr></table></figure>
<h6 id="安装其他babel库"><a href="#安装其他babel库" class="headerlink" title="安装其他babel库"></a>安装其他babel库</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev  babel-preset-env</div></pre></td></tr></table></figure>
<h6 id="项目目录新建-babelrc-文件-参考配置"><a href="#项目目录新建-babelrc-文件-参考配置" class="headerlink" title="项目目录新建 .babelrc 文件(参考配置)"></a>项目目录新建 .babelrc 文件(参考配置)</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;presets&quot;: [</div><div class="line">    [&quot;env&quot;, &#123;</div><div class="line">      &quot;modules&quot;: false,</div><div class="line">      &quot;targets&quot;: &#123;</div><div class="line">        &quot;browsers&quot;: [&quot;&gt; 1%&quot;, &quot;last 2 versions&quot;, &quot;not ie &lt;= 8&quot;]</div><div class="line">      &#125;</div><div class="line">    &#125;]</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h6 id="设置phpstorm-的js开发语言版本为ES6"><a href="#设置phpstorm-的js开发语言版本为ES6" class="headerlink" title="设置phpstorm 的js开发语言版本为ES6"></a>设置phpstorm 的js开发语言版本为ES6</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">file - setting - languages &amp; frameworks - Javascript</div></pre></td></tr></table></figure>
<p><img src="http://mwebblog-1252916789.file.myqcloud.com/15106265162468.jpg?sign=tHJxXOhKRd/3Z+2g/2kMaE7HkKZhPTEyNTI5MTY3ODkmaz1BS0lESWR0eHdzUk51SVVUS082N0M1bGtjSW04SUxHTUo1dWYmZT0xNTEzMjE5NzEzJnQ9MTUxMDYyNzcxMyZyPTM1NjY4MTQxOCZmPS8xNTEwNjI2NTE2MjQ2OC5qcGcmYj1td2ViYmxvZw==" alt=""></p>
<h6 id="设置phpstorm-file-watchers-新增babel"><a href="#设置phpstorm-file-watchers-新增babel" class="headerlink" title="设置phpstorm file watchers 新增babel"></a>设置phpstorm file watchers 新增babel</h6><p><img src="http://mwebblog-1252916789.file.myqcloud.com/15106256931462.jpg?sign=cD6fOG7KwevTBUUVLQF3NhhCsFRhPTEyNTI5MTY3ODkmaz1BS0lESWR0eHdzUk51SVVUS082N0M1bGtjSW04SUxHTUo1dWYmZT0xNTEzMjE5NzEzJnQ9MTUxMDYyNzcxMyZyPTIyMDAxMTM1MyZmPS8xNTEwNjI1NjkzMTQ2Mi5qcGcmYj1td2ViYmxvZw==" alt=""></p>
<h6 id="babel-设置"><a href="#babel-设置" class="headerlink" title="babel 设置"></a>babel 设置</h6><p><img src="http://mwebblog-1252916789.file.myqcloud.com/15106266742735.jpg?sign=Vn6oSMaAG87r4cg+CmkW/aLcqPxhPTEyNTI5MTY3ODkmaz1BS0lESWR0eHdzUk51SVVUS082N0M1bGtjSW04SUxHTUo1dWYmZT0xNTEzMjE5NzEzJnQ9MTUxMDYyNzcxMyZyPTgwNzcwMTA5MiZmPS8xNTEwNjI2Njc0MjczNS5qcGcmYj1td2ViYmxvZw==" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Program 配置参考  </div><div class="line">/usr/local/bin/babel      //这个目录是node npm全局模块的目录</div><div class="line">Arguments 配置参考 </div><div class="line">$FilePathRelativeToProjectRoot$ --out-file $FileDir$/$FileNameWithoutExtension$-compile.js --source-maps --presets env      //输出文件设置</div><div class="line">Output pashs to refresh 输出路径刷新配置参考</div><div class="line">dist/$FileDirRelativeToProjectRoot$/$FileNameWithoutExtension$.js:dist/$FileDirRelativeToProjectRoot$/$FileNameWithoutExtension$.js.map</div></pre></td></tr></table></figure>
<p><img src="http://mwebblog-1252916789.file.myqcloud.com/15106272337086.jpg?sign=HljAcJLbYyh2vb96BDfrVRhE3c1hPTEyNTI5MTY3ODkmaz1BS0lESWR0eHdzUk51SVVUS082N0M1bGtjSW04SUxHTUo1dWYmZT0xNTEzMjE5NzEzJnQ9MTUxMDYyNzcxMyZyPTEzNzU2MjY3MjUmZj0vMTUxMDYyNzIzMzcwODYuanBnJmI9bXdlYmJsb2c=" alt="作用域设置"></p>
<p>我遇到的坑是 作用域设置的是项目文件 导致编译的时候会产生多个文件</p>
<h4 id="一定设置作用域-Scope-为current-Files-为当前文件或者open-file编译"><a href="#一定设置作用域-Scope-为current-Files-为当前文件或者open-file编译" class="headerlink" title="一定设置作用域(Scope)为current Files  为当前文件或者open file编译"></a>一定设置作用域(Scope)为current Files  为当前文件或者open file编译</h4><p>####文章参考来源</p>
<ul>
<li><a href="http://blog.csdn.net/peade/article/details/76522177" target="_blank" rel="external">http://blog.csdn.net/peade/article/details/76522177</a> </li>
<li><a href="http://blog.csdn.net/huangpb123/article/details/70208095" target="_blank" rel="external">http://blog.csdn.net/huangpb123/article/details/70208095</a></li>
<li><a href="http://blog.csdn.net/u012212157/article/details/52831761" target="_blank" rel="external">http://blog.csdn.net/u012212157/article/details/52831761</a></li>
<li><a href="https://www.zhihu.com/question/43414079" target="_blank" rel="external">https://www.zhihu.com/question/43414079</a></li>
<li><a href="http://babeljs.io/docs/setup/#installation" target="_blank" rel="external">http://babeljs.io/docs/setup/#installation</a></li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/ES6-javascript-babel/">ES6 javascript babel</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/10/16/macOs 调试安卓设备 adb 调试工具步骤/"><span>macOs 调试安卓设备 adb 调试工具步骤</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/10/16/macOs 调试安卓设备 adb 调试工具步骤/" rel="bookmark">
        <time class="entry-date published" datetime="2017-10-16T04:00:35.000Z">
          2017-10-16
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <a id="more"></a>
<h4 id="获取厂商ID地址"><a href="#获取厂商ID地址" class="headerlink" title="获取厂商ID地址"></a>获取厂商ID地址</h4><p>Vendor ID</p>
<h4 id="配置配置文件"><a href="#配置配置文件" class="headerlink" title="配置配置文件"></a>配置配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vi  ~/.android/adb_usb.ini</div><div class="line">//添加厂商ID</div></pre></td></tr></table></figure>
<h4 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h4> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">./adb kill-server</div><div class="line">./adb start-server</div><div class="line">//查看是否获取设备</div><div class="line">./adb devices</div></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/H5调试/">H5调试</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/08/20/网络安全/"><span>网络安全入门（信息收集）</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/08/20/网络安全/" rel="bookmark">
        <time class="entry-date published" datetime="2017-08-20T14:02:28.000Z">
          2017-08-20
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <a id="more"></a>
<p>###google浏览器搜索技巧</p>
<p>####常用的googlehacking语法：</p>
<ul>
<li>intext:要搜索的内容  把网页中的正文内容中的某个字符作为搜索条件</li>
<li>intitle:要搜索的内容  把标题中的某个字符作为搜索条件</li>
<li>cache:要搜索的内容 搜索引擎关于某些内容的缓存 可能发现有价值的信息</li>
<li>filetype:要搜索的内容 指定一个格式类型的文件作为搜索条件</li>
<li>inurl:要搜索的内容 inurl:php?id=  inurl:jsp?id= 搜索包含指定字符的URL</li>
<li>site:要搜索的内容 在指定的站点搜索相关内容</li>
<li>引号” “ 吧关键字打上引号后把引号部分作为整体来搜索</li>
<li>or  同事搜索两个或者更多的关键词</li>
<li><p>link 搜索某个网站的链接</p>
</li>
<li><p>组合使用 intitle:admin  inurl:admin</p>
</li>
<li>组合 intitle:海尔 inurl:php?id=</li>
</ul>
<h4 id="典型用法"><a href="#典型用法" class="headerlink" title="典型用法"></a>典型用法</h4><p>1.找管理后台地址</p>
<ul>
<li>site:xxx.com intext:管理|后台|登录|用户名|密码|系统|账号</li>
<li>site:xxx.com inurl:login|admin|manage| manager|admin_login|system</li>
<li>site:xxx.com intitle:管理|后台|登录</li>
</ul>
<p>2.找上传类漏洞</p>
<ul>
<li>site:xxx.com inurl:file</li>
<li>site:xxx.com inurl:upload</li>
</ul>
<p>3.找注入页面：</p>
<ul>
<li>site:xxx.com inurl:php?id=</li>
</ul>
<p>4.找编辑器页面</p>
<ul>
<li>site:xxx.com inurl:ewebeditor</li>
</ul>
<h2 id="使用站长工具对目标站点进行信息收集"><a href="#使用站长工具对目标站点进行信息收集" class="headerlink" title="使用站长工具对目标站点进行信息收集"></a>使用站长工具对目标站点进行信息收集</h2><ul>
<li>IP查询</li>
<li>同IP查询</li>
<li>WHOIS查询和反查</li>
<li>子域名查询</li>
<li>识别服务器类型，页面类型</li>
<li>DNS信息查询</li>
<li>网站安全检测</li>
<li>端口扫描</li>
</ul>
<p>邮箱活动查询</p>
<ul>
<li><a href="http://www.0xreg.com" target="_blank" rel="external">灵查注册</a> (亲测不能用了)主要查询邮箱进行的一些活动</li>
<li><a href="http://www.reg007.com" target="_blank" rel="external">查询注册过的邮箱</a></li>
</ul>
<p>##漏洞信息收集</p>
<h4 id="漏洞平台寻找漏洞信息"><a href="#漏洞平台寻找漏洞信息" class="headerlink" title="漏洞平台寻找漏洞信息"></a>漏洞平台寻找漏洞信息</h4><ul>
<li>乌云漏洞平台 已暂停</li>
<li><a href="https://security.360.cn/" target="_blank" rel="external">360补天漏洞平台</a></li>
<li><a href="https://www.exploit-db.com/" target="_blank" rel="external">Exploit-DB</a></li>
<li><a href="https://www.exploit-db.com/google-hacking-database/" target="_blank" rel="external">GHDB</a></li>
<li><a href="http://cve.scap.org.cn/" target="_blank" rel="external">CVE中文漏洞信息库</a></li>
<li><a href="http://www.cnnvd.org.cn" target="_blank" rel="external">中国国家信息安全漏洞库</a></li>
<li><a href="http://www.cert.org.cn/" target="_blank" rel="external">国家互联网应急中心</a></li>
</ul>
<h4 id="使用搜索引擎搜索漏洞-文件类上传类等等"><a href="#使用搜索引擎搜索漏洞-文件类上传类等等" class="headerlink" title="使用搜索引擎搜索漏洞 文件类上传类等等"></a>使用搜索引擎搜索漏洞 文件类上传类等等</h4><p>###使用工具手机信息</p>
<p>常用的DOS命令</p>
<ul>
<li>ping 网络连通测试</li>
<li>arp    arp -a 显示和修改地址解析协议</li>
<li>tracert  tracert www.baidu.com  本机连接到百度所需要的路由</li>
<li>nslookup 域名系统查询</li>
<li>telnet  telnet：地址 测试是否开启远程连接</li>
<li>netstat 查看本地及其所有开放端口</li>
<li>nbtstat 获取NetBIOS信息</li>
<li>ftp 测试开放了ftp的远程主机</li>
<li>net 最重要的命令 需要透彻掌握每一个自命令</li>
</ul>
<p>御剑扫描工具</p>
<p>扫描站点<br>moonsos.com<br>secbuf.com</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/网络安全/">网络安全</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/08/14/JSON WEB TOKEN /"><span>NODE.JS EXPRESS JWT Token</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/08/14/JSON WEB TOKEN /" rel="bookmark">
        <time class="entry-date published" datetime="2017-08-14T02:07:21.000Z">
          2017-08-14
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <a id="more"></a>
<p><img src="./token.png" alt=""></p>
<h3 id="已安装好node-express-以下为普通登录返回token的操作"><a href="#已安装好node-express-以下为普通登录返回token的操作" class="headerlink" title="已安装好node express 以下为普通登录返回token的操作"></a>已安装好node express 以下为普通登录返回token的操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">//安装模块</div><div class="line">npm i jwt-simple --save</div><div class="line">//使用模块</div><div class="line">const jwt = require(&apos;jwt-simple&apos;);</div><div class="line">//需要使用express</div><div class="line">var app = express();</div><div class="line">//设置秘钥</div><div class="line">app.set(&apos;jwtTokenSecret&apos;, &apos;CGerAJ&apos;);</div><div class="line"></div><div class="line">// @file login.js  ajax请求login地址获取token 此处/指向的是login接口</div><div class="line">router.post(&apos;/&apos;, function(req, res, next) &#123;</div><div class="line"></div><div class="line">// 开发环境设置跨域访问</div><div class="line">res.header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</div><div class="line">res.header(&apos;Access-Control-Allow-Methods&apos;, &apos;PUT, GET, POST, DELETE, OPTIONS&apos;);</div><div class="line">res.header(&quot;Access-Control-Allow-Headers&quot;, &quot;X-Requested-With&quot;);</div><div class="line">res.header(&apos;Access-Control-Allow-Headers&apos;, &apos;Content-Type&apos;);</div><div class="line"></div><div class="line">  // 后端验证判断名字或者密码是否为空 这里使用的是明文 部署环境需要使用加密算法传输</div><div class="line">  if (!req.body.names || !req.body.password ) &#123;</div><div class="line">    return res.status(400).send(&quot;用户名或者密码不能为空！&quot;);</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  // 查数据库</div><div class="line">  User.findOne(&#123; username: req.body.names &#125;, function(err, user) &#123;</div><div class="line">  </div><div class="line">	    if (err) &#123;</div><div class="line">	      // 如果报错</div><div class="line">	      return res.sendStatus(401).json(&#123; success: false&#125;);</div><div class="line">	    &#125;</div><div class="line">	    </div><div class="line">	    if (!user) &#123;</div><div class="line">	      // 用户没找到的情况</div><div class="line">	      return res.sendStatus(401).json(&#123; success: false&#125;);</div><div class="line">	    &#125;</div><div class="line">	    </div><div class="line">	    if ( req.body.password !== user.userpwd) &#123;</div><div class="line">	      // 密码不对的情况</div><div class="line">	      return res.sendStatus(401).json(&#123; success: false&#125;);</div><div class="line">	    &#125;</div><div class="line">	    </div><div class="line">	    // 过期时间 一般设置为小时 此处为天</div><div class="line">	    var expires = moment().add(&apos;days&apos;, 1).valueOf();</div><div class="line">	    </div><div class="line">	    // 验证通过 执行token生成</div><div class="line">	    var token = jwt.encode(&#123;</div><div class="line">	        iss: user.username,</div><div class="line">	        exp: expires</div><div class="line">      &#125;,</div><div class="line">      app.get(&apos;jwtTokenSecret&apos;));</div><div class="line">     res.status(200).json(&#123; </div><div class="line">	     success: true,</div><div class="line">	     token : token,</div><div class="line">	     expires: expires,</div><div class="line">	     user: user.toJSON()</div><div class="line">     &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">前端根据返回的token 存到本地 跳转页面  单页面路由跳转前端验证token是否存在 不存在返回登录页</div><div class="line">localStorage.token=data.token;</div><div class="line">window.location.href = &quot;http://localhost:8080/view/user&quot;;</div></pre></td></tr></table></figure>
<h3 id="前端请求接口"><a href="#前端请求接口" class="headerlink" title="前端请求接口"></a>前端请求接口</h3><p>请求数据带上token</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$(&quot;#submit&quot;).click(function(event) &#123;</div><div class="line">	var token = window.localStorage.getItem(&apos;token&apos;);</div><div class="line">	if (token) &#123;</div><div class="line">		$.ajax(&#123;</div><div class="line">				url: &apos;http://localhost:3001/data&apos;,</div><div class="line">				type: &apos;POST&apos;,</div><div class="line">				dataType: &apos;JSON&apos;,</div><div class="line">				data: &#123;</div><div class="line">					token: token</div><div class="line">				&#125;,</div><div class="line">			&#125;)</div><div class="line">			.done(function(data) &#123;</div><div class="line">				console.log(data);</div><div class="line">				//返回数据的操作</div><div class="line">				console.log(&quot;success&quot;);</div><div class="line">			&#125;)</div><div class="line">			.fail(function() &#123;</div><div class="line">				console.log(&quot;error&quot;);</div><div class="line">			&#125;)</div><div class="line">			.always(function() &#123;</div><div class="line">				console.log(&quot;complete&quot;);</div><div class="line">			&#125;);</div><div class="line">	&#125; else &#123;</div><div class="line">		window.location.href = &apos;http://localhost:8080/view/login&apos;;</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="TOKEN过期处理"><a href="#TOKEN过期处理" class="headerlink" title="TOKEN过期处理"></a>TOKEN过期处理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h4 id="验证Token"><a href="#验证Token" class="headerlink" title="验证Token"></a>验证Token</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 验证token</div><div class="line"> * @return Boolean | true || false</div><div class="line"> */</div><div class="line">function checkToken(token)&#123;</div><div class="line">	//过期时间验证 返回布尔值Boolean</div><div class="line">	//如果过期Expired</div><div class="line">	if( Expired )&#123;</div><div class="line">	    //先生成新的token 如果生成失败 return;</div><div class="line">	    newToken(username,secret);</div><div class="line">		//把过期的token添加黑名单</div><div class="line">		addToBlacklist();</div><div class="line">		//返回一个新的token回前端</div><div class="line">		parseToken();</div><div class="line">	&#125;else&#123;</div><div class="line">	//token未过期返回Boolean true</div><div class="line">    return true;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h4 id="将旧的Token加入黑名单"><a href="#将旧的Token加入黑名单" class="headerlink" title="将旧的Token加入黑名单"></a>将旧的Token加入黑名单</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 添加当前token到黑名单</div><div class="line"> */</div><div class="line">function addToBlacklist(token)&#123;</div><div class="line">   //加入到黑名单</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="生成一个新的Token"><a href="#生成一个新的Token" class="headerlink" title="生成一个新的Token"></a>生成一个新的Token</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 生成一个新的token</div><div class="line"> * @param username secret</div><div class="line"> * @return  Token | string</div><div class="line"> */</div><div class="line">function newToken(username,secret)&#123;</div><div class="line">  //生成新Token</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="返回Token到前台"><a href="#返回Token到前台" class="headerlink" title="返回Token到前台"></a>返回Token到前台</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 从请求解析返回Token</div><div class="line"> * @return Token</div><div class="line"> * @throws TokenNotFoundException</div><div class="line"> */</div><div class="line">function parseToken()&#123;</div><div class="line">  //解析返回</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/NODEJS/">NODEJS</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/07/17/docker学习笔记/"><span>docker 学习笔记</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/07/17/docker学习笔记/" rel="bookmark">
        <time class="entry-date published" datetime="2017-07-17T07:48:00.000Z">
          2017-07-17
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <a id="more"></a>
<h2 id="安装Docker-gt-下载镜像-gt-使用Dockerfile定制镜像-gt-构建镜像-gt-用构建的镜像启动容器-gt-数据交互-gt-容器互联"><a href="#安装Docker-gt-下载镜像-gt-使用Dockerfile定制镜像-gt-构建镜像-gt-用构建的镜像启动容器-gt-数据交互-gt-容器互联" class="headerlink" title="安装Docker -&gt; 下载镜像 -&gt; 使用Dockerfile定制镜像 -&gt; 构建镜像 -&gt; 用构建的镜像启动容器 -&gt; 数据交互 -&gt; 容器互联"></a>安装Docker -&gt; 下载镜像 -&gt; 使用Dockerfile定制镜像 -&gt; 构建镜像 -&gt; 用构建的镜像启动容器 -&gt; 数据交互 -&gt; 容器互联</h2><h2 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h2><p>从Docker Registry 获取镜像的命令 docker pull</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker pull [选项] [Docker Registry地址] &lt;仓库名&gt;:&lt;标签&gt;</div></pre></td></tr></table></figure>
<ul>
<li>Docker Registry地址格式 域名:端口号</li>
<li>仓库名 用户名 软件名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ docker pull ubuntu:14.04</div><div class="line">14.04: Pulling from library/ubuntu</div><div class="line">bf5d46315322: Pull complete</div><div class="line">9f13e0ac480c: Pull complete</div><div class="line">e8988b5b3097: Pull complete</div><div class="line">40af181810e7: Pull complete</div><div class="line">e6f7c7e5c03e: Pull complete</div><div class="line">Digest: sha256:147913621d9cdea08853f6ba9116c2e27a3ceffecf3b49298</div><div class="line">3ae97c3d643fbbe</div><div class="line">Status: Downloaded newer image for ubuntu:14.04</div><div class="line">``` </div><div class="line">上面的命令中没有给出 Docker Registry 地址，因此将会从 Docker Hub 获取镜</div><div class="line">像。而镜像名称是 ubuntu:14.04 ，因此将会获取官方镜像 library/ubuntu</div><div class="line">仓库中标签为 14.04 的镜像。</div><div class="line">## 查看容器</div></pre></td></tr></table></figure>
<p>docker ps<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">## 启动容器</div></pre></td></tr></table></figure></p>
<p>docker run -it –rm ubuntu:14.04 bash<br>root@e7009c6ce357:/# cat /etc/os-release<br>NAME=”Ubuntu”<br>VERSION=”14.04.5 LTS, Trusty Tahr”<br>ID=ubuntu<br>ID_LIKE=debian<br>PRETTY_NAME=”Ubuntu 14.04.5 LTS”<br>VERSION_ID=”14.04”<br>HOME_URL=”<a href="http://www.ubuntu.com/" target="_blank" rel="external">http://www.ubuntu.com/</a>“<br>SUPPORT_URL=”<a href="http://help.ubuntu.com/" target="_blank" rel="external">http://help.ubuntu.com/</a>“<br>BUG_REPORT_URL=”<a href="http://bugs.launchpad.net/ubuntu/" target="_blank" rel="external">http://bugs.launchpad.net/ubuntu/</a>“<br>root@e7009c6ce357:/# exit<br>exit<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">- 运行容器的命令 docker run</div><div class="line">-  -it ：这是两个参数，一个是 -i ：交互式操作，一个是 -t 终端。我们</div><div class="line">这里打算进入 bash 执行一些命令并查看返回结果，因此我们需要交互式终</div><div class="line">获取镜像端。</div><div class="line">- --rm ：这个参数是说容器退出后随之将其删除。默认情况下，为了排障需</div><div class="line">求，退出的容器并不会立即删除，除非手动 docker rm 。我们这里只是随便</div><div class="line">执行个命令，看看结果，不需要排障和保留结果，因此使用 --rm 可以避免</div><div class="line">浪费空间。</div><div class="line">- ubuntu:14.04 ：这是指用 ubuntu:14.04 镜像为基础来启动容器。</div><div class="line">- bash ：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的</div><div class="line">是 bash 。</div><div class="line"></div><div class="line">进入容器后，我们可以在 Shell 下操作，执行任何所需的命令。这里，我们执行了</div><div class="line">cat /etc/os-release ，这是 Linux 常用的查看当前系统版本的命令，从返回的</div><div class="line">结果可以看到容器内是 Ubuntu 14.04.5 LTS 系统。</div><div class="line">最后我们通过 exit 退出了这个容器。</div><div class="line"></div><div class="line"></div><div class="line">## 查看镜像 docker images  会列出所有下载的镜像</div><div class="line"></div><div class="line">- 虚悬镜像 &lt;none&gt; 产生原因 被新版镜像覆盖</div><div class="line">这个镜像原本是有镜像名和标签的，原来为 老版本镜像镜像名（mongo:3.2） ，发</div><div class="line">布了新版本后，重新 docker pull mongo:3.2 时， mongo:3.2 这个镜像名被</div><div class="line">转移到了新下载的镜像身上，而旧的镜像上的这个名称则被取消，从而成为了</div><div class="line">&lt;none&gt; 。除了 docker pull 可能导致这种情况， docker build 也同样可</div><div class="line">以导致这种现象。由于新旧镜像同名，旧镜像名称被取消，从而出现仓库名、标签</div><div class="line">均为 &lt;none&gt; 的镜像。这类无标签镜像也被称为 虚悬镜像(dangling image) ，可</div><div class="line">以用下面的命令专门显示这类镜像：</div><div class="line"></div><div class="line">- 删除镜像docker rmi 镜像名</div><div class="line">- 删除容器 docker rm 容器名</div><div class="line"></div><div class="line">## 使用 Dockerfile 定制镜像</div><div class="line">- 新建Dockerfile文件 （文本文件）</div></pre></td></tr></table></figure></p>
<p>mkdir mynginx<br>cd mynginx<br>touch Dockerfile<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- 往Dockerfile添加内容</div></pre></td></tr></table></figure></p>
<p>FROM nginx<br>RUN echo ‘</p><h1>Hello, Docker!</h1>‘ &gt; /usr/share/nginx/html/index<br>.html<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- FROM 指定基础镜像</div><div class="line">	- FROM 为dockfile 的必备指令</div><div class="line">	- Docker 还存在一个特殊的镜像，名为scratch。这个镜像是虚拟的概念，并不实际存在，它表示一个空白的镜像。</div><div class="line">- RUN 执行命令</div><div class="line">	- 格式： RUN [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;] </div><div class="line"> 	- 每run 一次就构建一层镜像 不得超过 127 层</div><div class="line"></div><div class="line"></div><div class="line">- 正确的构建方式</div></pre></td></tr></table></figure><p></p>
<p>FROM debian:jessie<br>RUN buildDeps=’gcc libc6-dev make’ \<br>&amp;&amp; apt-get update \<br>&amp;&amp; apt-get install -y $buildDeps \<br>&amp;&amp; wget -O redis.tar.gz “<a href="http://download.redis.io/releases/r" target="_blank" rel="external">http://download.redis.io/releases/r</a><br>edis-3.2.5.tar.gz” \<br>&amp;&amp; mkdir -p /usr/src/redis \<br>&amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis –strip-component<br>s=1 \<br>&amp;&amp; make -C /usr/src/redis \<br>&amp;&amp; make -C /usr/src/redis install \<br>&amp;&amp; rm -rf /var/lib/apt/lists/* \<br>&amp;&amp; rm redis.tar.gz \<br>&amp;&amp; rm -r /usr/src/redis \<br>&amp;&amp; apt-get purge -y –auto-remove $buildDeps<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">  -	 首先，之前所有的命令只有一个目的，就是编译、安装 redis 可执行文件。因此没</div><div class="line">有必要建立很多层，这只是一层的事情。因此，这里没有使用很多个 RUN 对一一</div><div class="line">对应不同的命令，而是仅仅使用一个 RUN 指令，并使用 &amp;&amp; 将各个所需命令串</div><div class="line">联起来。将之前的 7 层，简化为了 1 层。在撰写 Dockerfile 的时候，要经常提醒自</div><div class="line">己，这并不是在写 Shell 脚本，而是在定义每一层该如何构建</div><div class="line">  - 并且，这里为了格式化还进行了换行。Dockerfile 支持 Shell 类的行尾添加 \ 的命令换行方式，以及行首 # 进行注释的格式。良好的格式，比如换行、缩进、注</div><div class="line">释等，会让维护、排障更为容易，这是一个比较好的习惯。</div><div class="line">此外，还可以看到这一组命令的最后添加了清理工作的命令，删除了为了编译构建</div><div class="line">所需要的软件，清理了所有下载、展开的文件，并且还清理了 apt 缓存文件。这</div><div class="line">是很重要的一步，我们之前说过，镜像是多层存储，每一层的东西并不会在下一层</div><div class="line">被删除，会一直跟随着镜像。因此镜像构建时，一定要确保每一层只添加真正需要</div><div class="line">添加的东西，任何无关的东西都应该清理掉。</div><div class="line"></div><div class="line"></div><div class="line">## 根据Dockerfile 构建出一个容器</div><div class="line">- 写好dockerfile</div><div class="line"></div><div class="line">	```1</div></pre></td></tr></table></figure></p>
<ul>
<li><p>执行docker构建命令</p>
  <figure class="highlight docker"><figcaption><span>build -t image_name Dockerfile_path```   </span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line"><span class="comment">## Dockerfile 指令详解</span></div><div class="line"><span class="comment">### copy </span></div><div class="line"></div><div class="line">- <span class="keyword">COPY</span> &lt;源路径&gt;... &lt;目标路径&gt;  命令行</div><div class="line">- COPY ["&lt;源路径1&gt;",... "&lt;目标路径&gt;"]  类似函数调用</div><div class="line">	</div><div class="line">### ADD 更高级的复制文件 官方推荐使用copy</div><div class="line">- 自动解压缩包 最适合使用 ADD 的场合，就是所提及的需要自动解压缩的场合。</div><div class="line">- url路径会自动下载</div></pre></td></tr></table></figure>
</li>
</ul>
<p>FROM scratch ADD ubuntu-xenial-core-cloudimg-amd64-root.tar.gz<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### CMD 容器启动命令</div><div class="line">- 是直接执行 nginx 可执行文件，并且要求以前台形式运行</div></pre></td></tr></table></figure></p>
<p>CMD [“nginx”, “-g”, “daemon off;”]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">### ENV 设置环境变量</div></pre></td></tr></table></figure></p>
<p>ENV <key> <value><br>ENV <key1>=<value1> <key2>=<value2>…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### VOLUME 定义匿名卷</div><div class="line">容器运行时应该尽量保持容器存储层不发生写操作，对于数据库类</div><div class="line">需要保存动态数据的应用，其数据库文件应该保存于卷(volume)中，后面的章节我</div><div class="line">们会进一步介绍 Docker 卷的概念。为了防止运行时用户忘记将动态文件所保存目</div><div class="line">录挂载为卷，在 Dockerfile 中，我们可以事先指定某些目录挂载为匿名卷，这</div><div class="line">样在运行时如果用户不指定挂载，其应用也可以正常运行，不会向容器存储层写入</div><div class="line">大量数据</div></pre></td></tr></table></figure></value2></key2></value1></key1></value></key></p>
<p>在Dockfile添加VOLUME<br>VOLUME /data<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">这里的 /data 目录就会在运行时自动挂载为匿名卷，任何向 /data 中写入的</div><div class="line">信息都不会记录进容器存储层，从而保证了容器存储层的无状态化。当然，运行时</div><div class="line">可以覆盖这个挂载设置</div></pre></td></tr></table></figure></p>
<p>在这行命令中，就使用了 mydata 这个命名卷挂载到了 /data 这个位置，替代<br>了 Dockerfile 中定义的匿名卷的挂载配置。</p>
<p>docker run -d -v mydata:/data xxxx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">### EXPOSE 声明端口</div><div class="line"></div><div class="line">```EXPOSE &lt;端口1&gt; [&lt;端口2&gt;...]``` </div><div class="line"></div><div class="line">### WORKDIR 指定工作目录</div><div class="line"></div><div class="line"></div><div class="line">```WORKDIR &lt;工作目录路径&gt;</div></pre></td></tr></table></figure></p>
<h3 id="USER-指定当前用户"><a href="#USER-指定当前用户" class="headerlink" title="USER 指定当前用户"></a>USER 指定当前用户</h3><figure class="highlight plain"><figcaption><span><用户名>```</用户名></span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### HEALTHCHECK 健康检查</div></pre></td></tr></table></figure>
<p>HEALTHCHECK [选项] CMD &lt;命令&gt; ：设置检查容器健康状况的命令</p>
<p>HEALTHCHECK NONE ：如果基础镜像有健康检查指令，使用这行可以屏蔽掉<br>其健康检查指令</p>
<p>HEALTHCHECK 支持下列选项：</p>
<p>–interval=&lt;间隔&gt; ：两次健康检查的间隔，默认为 30 秒；</p>
<p>–timeout=&lt;时长&gt; ：健康检查命令运行超时时间，如果超过这个时间，本次<br>健康检查就被视为失败，默认 30 秒；</p>
<p>–retries=&lt;次数&gt; ：当连续失败指定次数后，则将容器状态视为<br>unhealthy ，默认 3 次。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">##操作 Docker 容器</div></pre></td></tr></table></figure></p>
<p>docker run -d -p 80:80 –name webserver nginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- - d 守护进程</div><div class="line">- - p 端口映射 本地80端口映射到nginx 80端口 </div><div class="line">- -- name 命名  </div><div class="line">- webserver nginx服务名</div><div class="line">- nginx 使用nginx镜像构建容器</div></pre></td></tr></table></figure></p>
<p>docker stop webserver<br>docker rm webserver<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- 停止webserver</div><div class="line">- 删除webserver</div><div class="line"></div><div class="line"></div><div class="line">## 数据卷</div><div class="line"></div><div class="line">###创建一个数据卷</div><div class="line"></div><div class="line">- 数据卷可以在容器之间共享和重用</div><div class="line">- 对数据卷的修改会立马生效</div><div class="line">- 对数据卷的更新，不会影响镜像</div><div class="line">- 数据卷默认会一直存在，即使容器被删除</div><div class="line">- 注意：数据卷的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的被指定</div><div class="line">为挂载点的目录中的文件会隐藏掉，能显示看的是挂载的数据卷。</div></pre></td></tr></table></figure></p>
<p>创建一个数据卷<br>，使用 -v 标记来创建一个数据卷并挂载到容器<br>里。在一次 run 中多次使用可以挂载多个数据卷。</p>
<p> sudo docker run -d -P –name web -v /webapp training/webapp py<br>thon app.py<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">###挂载一个主机目录作为数据卷</div><div class="line"></div><div class="line">在用 docker run 命令的时候，使用 -v 标记来创建一个数据卷并挂载到容器</div><div class="line">里。在一次 run 中多次使用可以挂载多个数据卷。</div><div class="line">下面创建一个名为 web 的容器，并加载一个数据卷到容器的 /webapp 目录。</div></pre></td></tr></table></figure></p>
<p>$ sudo docker run -d -P –name web -v /src/webapp:/opt/webapp tr<br>aining/webapp python app.py<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">##### Docker 挂载数据卷的默认权限是读写，用户也可以通过 :ro 指定为只读。</div></pre></td></tr></table></figure></p>
<p>$ sudo docker run -d -P –name web -v /src/webapp:/opt/webapp:ro<br>training/webapp python app.py<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">###查看数据卷的具体信息</div><div class="line">- 在主机里使用以下命令可以查看指定容器的信息</div></pre></td></tr></table></figure></p>
<p>docker inspect web(容器名web)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">####挂载一个本地主机文件作为数据卷</div></pre></td></tr></table></figure></p>
<p>sudo docker run –rm -it -v ~/.bash_history:/.bash_history ubu<br>ntu /bin/bash<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">##数据卷容器</div><div class="line"></div><div class="line">####创建容器卷</div></pre></td></tr></table></figure></p>
<p>$ sudo docker run -d -v /dbdata –name dbdata training/postgres<br>echo Data-only container for postgres<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#### 其他容器访问</div></pre></td></tr></table></figure></p>
<p>sudo docker run -d –volumes-from dbdata –name db1 training/p<br>ostgres<br>$ sudo docker run -d –volumes-from dbdata –name db2 training/p<br>ostgres<br>```</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/docker/">docker</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 CGerAJ
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>